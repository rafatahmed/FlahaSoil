flowchart TD
    Start([ğŸŒ User Visits FlahaSoil]) --> Landing[ğŸ  Landing Page<br/>landing.html]
    
    Landing --> Choice{User Choice}
    
    %% Demo Path
    Choice -->|Try Demo| DemoFlow[ğŸ§ª Demo Mode]
    DemoFlow --> DemoPage[ğŸ“Š Basic Demo<br/>demo.html]
    DemoPage --> DemoCalc[ğŸ§® Basic Soil Calculations<br/>No Authentication Required]
    DemoCalc --> DemoResult[ğŸ“‹ Demo Results<br/>Limited Features]
    DemoResult --> DemoEnd{Continue?}
    DemoEnd -->|Register| SignupModal
    DemoEnd -->|Exit| Landing
    
    %% Authentication Path
    Choice -->|Login| LoginModal[ğŸ” Login Modal]
    Choice -->|Sign Up| SignupModal[ğŸ“ Signup Modal]
    
    %% Login Flow
    LoginModal --> LoginValidation{Valid Credentials?}
    LoginValidation -->|No| LoginError[âŒ Login Error]
    LoginError --> LoginModal
    LoginValidation -->|Yes| LoginSuccess[âœ… Login Success]
    LoginSuccess --> StoreAuth[ğŸ’¾ Store JWT Token<br/>& User Data]
    StoreAuth --> RedirectMain[â†—ï¸ Redirect to Main App]
    
    %% Signup Flow
    SignupModal --> SignupValidation{Valid Data?}
    SignupValidation -->|No| SignupError[âŒ Signup Error]
    SignupError --> SignupModal
    SignupValidation -->|Yes| CreateUser[ğŸ‘¤ Create User Account]
    CreateUser --> SelectPlan[ğŸ¯ Plan Selection<br/>FREE/PROFESSIONAL/ENTERPRISE]
    SelectPlan --> EmailVerification[ğŸ“§ Send Verification Email]
    EmailVerification --> SignupSuccess[âœ… Account Created]
    SignupSuccess --> StoreAuth
    
    %% Main Application Flow
    RedirectMain --> MainApp[ğŸŒ± Main Webapp<br/>index.html]
    MainApp --> AuthCheck{Authenticated?}
    AuthCheck -->|No| Landing
    AuthCheck -->|Yes| TierCheck{User Tier?}
    
    %% Tier-Based Access
    TierCheck -->|FREE| FreeFeatures[ğŸ†“ Free Features<br/>â€¢ Basic Calculations<br/>â€¢ 50 analyses/month<br/>â€¢ No reports]
    TierCheck -->|PROFESSIONAL| ProFeatures[ğŸ’¼ Professional Features<br/>â€¢ Full 24-equation system<br/>â€¢ Unlimited analyses<br/>â€¢ PDF reports<br/>â€¢ Analysis history]
    TierCheck -->|ENTERPRISE| EntFeatures[ğŸ¢ Enterprise Features<br/>â€¢ All Professional features<br/>â€¢ Custom reports<br/>â€¢ API access<br/>â€¢ Priority support]
    
    %% Feature Access
    FreeFeatures --> SoilAnalysis[ğŸ§® Soil Analysis]
    ProFeatures --> SoilAnalysis
    EntFeatures --> SoilAnalysis
    
    SoilAnalysis --> InputValidation{Valid Input?}
    InputValidation -->|No| InputError[âŒ Input Error]
    InputError --> SoilAnalysis
    InputValidation -->|Yes| UsageCheck{Usage Limit?}
    
    UsageCheck -->|Exceeded| UsageError[âš ï¸ Usage Limit Reached<br/>Upgrade Required]
    UsageError --> UpgradePrompt[ğŸ’° Upgrade Prompt]
    UpgradePrompt --> MainApp
    
    UsageCheck -->|OK| ProcessAnalysis[âš™ï¸ Process Analysis<br/>Saxton & Rawls 2006]
    ProcessAnalysis --> AnalysisResult[ğŸ“Š Analysis Results]
    
    %% Results & Reports
    AnalysisResult --> ResultDisplay[ğŸ“ˆ Display Results<br/>â€¢ Soil properties<br/>â€¢ Water characteristics<br/>â€¢ Visualizations]
    
    ResultDisplay --> ReportChoice{Generate Report?}
    ReportChoice -->|No| ContinueAnalysis[ğŸ”„ Continue Analysis]
    ReportChoice -->|Yes| ReportAccess{Report Access?}
    
    ReportAccess -->|FREE| NoReportAccess[âŒ No Report Access<br/>Upgrade Required]
    NoReportAccess --> UpgradePrompt
    
    ReportAccess -->|PRO/ENT| GenerateReport[ğŸ“„ Generate PDF Report]
    GenerateReport --> ReportReady[âœ… Report Ready<br/>Download Available]
    
    %% Navigation Options
    ContinueAnalysis --> SoilAnalysis
    ReportReady --> NavigationChoice{Where to go?}
    NavigationChoice -->|New Analysis| SoilAnalysis
    NavigationChoice -->|Profile| ProfilePage[ğŸ‘¤ Profile Page<br/>profile.html]
    NavigationChoice -->|Advanced Demo| AdvancedDemo[âš¡ Advanced Demo<br/>advanced-demo.html]
    NavigationChoice -->|Logout| LogoutProcess[ğŸšª Logout Process]
    
    %% Profile Management
    ProfilePage --> ProfileFeatures[ğŸ‘¤ Profile Features<br/>â€¢ Usage statistics<br/>â€¢ Plan management<br/>â€¢ Account settings<br/>â€¢ Analysis history]
    ProfileFeatures --> ProfileActions{Action?}
    ProfileActions -->|Upgrade| PlanUpgrade[ğŸ’° Plan Upgrade]
    ProfileActions -->|Settings| AccountSettings[âš™ï¸ Account Settings]
    ProfileActions -->|History| AnalysisHistory[ğŸ“Š Analysis History]
    ProfileActions -->|Back| MainApp
    
    %% Advanced Features
    AdvancedDemo --> AdvancedCheck{Advanced Access?}
    AdvancedCheck -->|No| AdvancedUpgrade[ğŸ’° Upgrade for Advanced Features]
    AdvancedUpgrade --> MainApp
    AdvancedCheck -->|Yes| AdvancedFeatures[âš¡ Advanced Features<br/>â€¢ 3D visualizations<br/>â€¢ Comparative analysis<br/>â€¢ Real-time adjustments<br/>â€¢ Regional data]
    AdvancedFeatures --> MainApp
    
    %% Logout Process
    LogoutProcess --> ClearAuth[ğŸ—‘ï¸ Clear Authentication]
    ClearAuth --> Landing
    
    %% Styling
    classDef startEnd fill:#ffcdd2,stroke:#d32f2f,stroke-width:3px
    classDef process fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef error fill:#ffebee,stroke:#f44336,stroke-width:2px
    classDef success fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    classDef feature fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    classDef premium fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    
    class Start,Landing startEnd
    class DemoFlow,DemoPage,DemoCalc,MainApp,SoilAnalysis,ProcessAnalysis,GenerateReport,ProfilePage,AdvancedDemo process
    class Choice,LoginValidation,SignupValidation,AuthCheck,TierCheck,InputValidation,UsageCheck,ReportChoice,ReportAccess,NavigationChoice,ProfileActions,AdvancedCheck,DemoEnd decision
    class LoginError,SignupError,InputError,UsageError,NoReportAccess error
    class LoginSuccess,SignupSuccess,AnalysisResult,ReportReady success
    class FreeFeatures,ProFeatures,EntFeatures,ResultDisplay,ProfileFeatures,AdvancedFeatures feature
    class UpgradePrompt,PlanUpgrade,AdvancedUpgrade premium