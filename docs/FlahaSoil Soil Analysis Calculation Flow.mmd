flowchart TD
    %% Input Stage
    UserInput[ğŸ‘¤ User Input] --> InputValidation{Input Validation}
    
    %% Input Parameters
    subgraph "Input Parameters"
        Sand[ğŸ–ï¸ Sand %<br/>Range: 0-100%]
        Clay[ğŸ§± Clay %<br/>Range: 0-100%]
        OM[ğŸŒ± Organic Matter %<br/>Range: 0-8%]
        Density[âš–ï¸ Bulk Density<br/>Range: 0.9-1.8 g/cmÂ³]
        Gravel[ğŸª¨ Gravel Content %<br/>Range: 0-80%]
        EC[âš¡ Electrical Conductivity<br/>Range: 0-20 dS/m]
    end
    
    UserInput --> Sand
    UserInput --> Clay
    UserInput --> OM
    UserInput --> Density
    UserInput --> Gravel
    UserInput --> EC
    
    %% Validation Checks
    InputValidation -->|Invalid| ValidationErrors[âŒ Validation Errors<br/>Sand + Clay â‰¤ 100%<br/>All values in range<br/>Required fields present]
    ValidationErrors --> UserInput
    
    InputValidation -->|Valid| TierCheck{User Tier Check}
    
    %% Tier-Based Processing
    TierCheck -->|FREE| BasicCalculations[ğŸ†“ Basic Calculations<br/>Limited Equation Set]
    TierCheck -->|PROFESSIONAL| FullCalculations[ğŸ’¼ Full 24-Equation System<br/>Saxton & Rawls 2006]
    TierCheck -->|ENTERPRISE| EnhancedCalculations[ğŸ¢ Enhanced Calculations<br/>+ Gravel & Salinity Effects]
    
    %% Saxton & Rawls 2006 Equation System
    subgraph "Saxton & Rawls 2006 - 24 Equation System"
        %% Primary Equations 1-8
        Eq1[ğŸ“ Eq 1: Field Capacity Base]
        Eq2[ğŸ“ Eq 2: Field Capacity Adjusted]
        Eq3[ğŸ“ Eq 3: Wilting Point Base]
        Eq4[ğŸ“ Eq 4: Wilting Point Adjusted]
        Eq5[ğŸ“ Eq 5: Available Water]
        Eq6[ğŸ“ Eq 6: Saturated Content]
        Eq7[ğŸ“ Eq 7: B Parameter]
        Eq8[ğŸ“ Eq 8: Lambda Parameter]
        
        %% Density Adjustments 9-12
        Eq9[ğŸ“ Eq 9: Density Factor FC]
        Eq10[ğŸ“ Eq 10: Density Factor WP]
        Eq11[ğŸ“ Eq 11: FC Density Adjusted]
        Eq12[ğŸ“ Eq 12: WP Density Adjusted]
        
        %% Gravel Effects 13-16 Enterprise Only
        Eq13[ğŸ“ Eq 13: FC Gravel Adjusted]
        Eq14[ğŸ“ Eq 14: WP Gravel Adjusted]
        Eq15[ğŸ“ Eq 15: Saturated Gravel Adjusted]
        Eq16[ğŸ“ Eq 16: Conductivity Gravel Adjusted]
        
        %% Salinity Effects 17-20 Enterprise Only
        Eq17[ğŸ“ Eq 17: FC Salinity Adjusted]
        Eq18[ğŸ“ Eq 18: WP Salinity Adjusted]
        Eq19[ğŸ“ Eq 19: Conductivity Salinity Adjusted]
        Eq20[ğŸ“ Eq 20: Air Entry Salinity Adjusted]
        
        %% Advanced Properties 21-24 Professional+
        Eq21[ğŸ“ Eq 21: Hydraulic Conductivity]
        Eq22[ğŸ“ Eq 22: Air Entry Potential]
        Eq23[ğŸ“ Eq 23: S-Index]
        Eq24[ğŸ“ Eq 24: RÂ² Confidence Intervals]
    end
    
    %% Calculation Routing
    BasicCalculations --> Eq1
    BasicCalculations --> Eq2
    BasicCalculations --> Eq3
    BasicCalculations --> Eq4
    BasicCalculations --> Eq5
    BasicCalculations --> Eq6
    
    FullCalculations --> Eq1
    FullCalculations --> Eq2
    FullCalculations --> Eq3
    FullCalculations --> Eq4
    FullCalculations --> Eq5
    FullCalculations --> Eq6
    FullCalculations --> Eq7
    FullCalculations --> Eq8
    FullCalculations --> Eq9
    FullCalculations --> Eq10
    FullCalculations --> Eq11
    FullCalculations --> Eq12
    FullCalculations --> Eq21
    FullCalculations --> Eq22
    FullCalculations --> Eq23
    FullCalculations --> Eq24
    
    EnhancedCalculations --> Eq1
    EnhancedCalculations --> Eq2
    EnhancedCalculations --> Eq3
    EnhancedCalculations --> Eq4
    EnhancedCalculations --> Eq5
    EnhancedCalculations --> Eq6
    EnhancedCalculations --> Eq7
    EnhancedCalculations --> Eq8
    EnhancedCalculations --> Eq9
    EnhancedCalculations --> Eq10
    EnhancedCalculations --> Eq11
    EnhancedCalculations --> Eq12
    EnhancedCalculations --> Eq13
    EnhancedCalculations --> Eq14
    EnhancedCalculations --> Eq15
    EnhancedCalculations --> Eq16
    EnhancedCalculations --> Eq17
    EnhancedCalculations --> Eq18
    EnhancedCalculations --> Eq19
    EnhancedCalculations --> Eq20
    EnhancedCalculations --> Eq21
    EnhancedCalculations --> Eq22
    EnhancedCalculations --> Eq23
    EnhancedCalculations --> Eq24
    
    %% Results Processing
    Eq6 --> ResultsProcessing[âš™ï¸ Results Processing]
    Eq8 --> ResultsProcessing
    Eq12 --> ResultsProcessing
    Eq16 --> ResultsProcessing
    Eq20 --> ResultsProcessing
    Eq24 --> ResultsProcessing
    
    %% Output Results
    ResultsProcessing --> SoilProperties[ğŸ“Š Soil Properties<br/>Field Capacity<br/>Wilting Point<br/>Available Water<br/>Saturated Content<br/>Bulk Density Effects]
    
    ResultsProcessing --> WaterCharacteristics[ğŸ’§ Water Characteristics<br/>Hydraulic Conductivity<br/>Air Entry Potential<br/>Moisture Retention<br/>Drainage Properties<br/>Infiltration Rate]
    
    ResultsProcessing --> QualityMetrics[ğŸ“ˆ Quality Metrics<br/>RÂ² Confidence Values<br/>Calculation Reliability<br/>Input Data Quality<br/>Recommendation Confidence]
    
    %% Advanced Outputs Professional+
    ResultsProcessing --> AdvancedOutputs{Advanced Features?}
    AdvancedOutputs -->|Professional+| Visualizations[ğŸ“ˆ Advanced Visualizations<br/>Moisture-Tension Curves<br/>3D Soil Profiles<br/>USDA Triangle Position<br/>Comparative Charts]
    
    AdvancedOutputs -->|Enterprise| EnterpriseOutputs[ğŸ¢ Enterprise Features<br/>Gravel Effect Analysis<br/>Salinity Impact Assessment<br/>Regional Comparisons<br/>Custom Parameters]
    
    %% Final Results
    SoilProperties --> FinalResults[âœ… Analysis Complete]
    WaterCharacteristics --> FinalResults
    QualityMetrics --> FinalResults
    Visualizations --> FinalResults
    EnterpriseOutputs --> FinalResults
    
    FinalResults --> ReportGeneration{Generate Report?}
    ReportGeneration -->|Yes| PDFReport[ğŸ“„ PDF Report Generation]
    ReportGeneration -->|No| DisplayResults[ğŸ“± Display Results]
    
    %% Styling
    classDef input fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef validation fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef basic fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef professional fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef enterprise fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef equation fill:#fff8e1,stroke:#f9a825,stroke-width:1px
    classDef result fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef error fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    
    class UserInput,Sand,Clay,OM,Density,Gravel,EC input
    class InputValidation,TierCheck,AdvancedOutputs,ReportGeneration validation
    class BasicCalculations basic
    class FullCalculations,Visualizations professional
    class EnhancedCalculations,EnterpriseOutputs enterprise
    class Eq1,Eq2,Eq3,Eq4,Eq5,Eq6,Eq7,Eq8,Eq9,Eq10,Eq11,Eq12,Eq13,Eq14,Eq15,Eq16,Eq17,Eq18,Eq19,Eq20,Eq21,Eq22,Eq23,Eq24 equation
    class SoilProperties,WaterCharacteristics,QualityMetrics,FinalResults,PDFReport,DisplayResults,ResultsProcessing result
    class ValidationErrors error