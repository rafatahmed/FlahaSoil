graph LR
    %% Frontend Applications
    subgraph "Frontend Applications"
        Landing[ğŸ  Landing Page]
        MainApp[ğŸŒ± Main Webapp]
        Demo[ğŸ§ª Demo Page]
        AdvDemo[âš¡ Advanced Demo]
        Profile[ğŸ‘¤ Profile Page]
    end
    
    %% API Gateway
    subgraph "API Gateway (Port 3001)"
        Gateway[ğŸšª Express Server<br/>server.js]
    end
    
    %% Authentication Routes
    subgraph "Authentication API (/api/v1/auth)"
        AuthRegister[ğŸ“ POST /register<br/>User Registration]
        AuthLogin[ğŸ” POST /login<br/>User Login]
        AuthVerify[âœ… GET /verify-email<br/>Email Verification]
        AuthReset[ğŸ”„ POST /reset-password<br/>Password Reset]
        AuthProfile[ğŸ‘¤ GET /profile<br/>User Profile]
    end
    
    %% Soil Analysis Routes
    subgraph "Soil Analysis API (/api/v1/soil)"
        %% Demo Endpoints
        DemoAnalyze[ğŸ§ª POST /demo/analyze<br/>Basic Demo Analysis]
        DemoEnhanced[âš¡ POST /demo/analyze/enhanced<br/>Enhanced Demo Analysis]
        DemoMoisture[ğŸ“ˆ GET /demo/moisture-tension/:data<br/>Demo Moisture Curve]
        DemoProfile3D[ğŸ”ï¸ GET /demo/profile-3d/:data<br/>Demo 3D Profile]
        
        %% Authenticated Endpoints
        BasicAnalyze[ğŸ§® POST /analyze<br/>Basic Analysis<br/>ğŸ” Auth Required]
        AdvAnalyze[âš¡ POST /analyze/advanced<br/>Advanced Analysis<br/>ğŸ’¼ Professional+]
        BatchAnalyze[ğŸ“Š POST /analyze/batch<br/>Batch Analysis<br/>ğŸ’¼ Professional+]
        
        %% Data & History
        AnalysisHistory[ğŸ“š GET /history<br/>Analysis History<br/>ğŸ’¼ Professional+]
        ExportData[ğŸ“¤ GET /export/:format<br/>Export Data<br/>ğŸ’¼ Professional+]
        Recommendations[ğŸŒ¾ POST /recommendations<br/>Crop Recommendations<br/>ğŸ” Auth Required]
        
        %% Advanced Features
        MoistureCurve[ğŸ“ˆ GET /moisture-tension/:id<br/>Moisture-Tension Curve<br/>ğŸ’¼ Professional+]
        Profile3D[ğŸ”ï¸ GET /profile-3d/:id<br/>3D Soil Profile<br/>ğŸ’¼ Professional+]
        CompareAnalyses[âš–ï¸ POST /compare<br/>Comparative Analysis<br/>ğŸ’¼ Professional+]
        RealtimeAdjust[âš¡ POST /adjust-realtime<br/>Real-time Adjustment<br/>ğŸ’¼ Professional+]
        
        %% Regional Data
        RegionalData[ğŸŒ GET /regional-data/:id<br/>Regional Soil Data<br/>ğŸ” Auth Required]
        AvailableRegions[ğŸ—ºï¸ GET /regions<br/>Available Regions<br/>ğŸ” Auth Required]
        
        %% Enterprise API
        EnterpriseAPI[ğŸ¢ POST /api/analyze<br/>Enterprise API<br/>ğŸ¢ Enterprise Only]
    end
    
    %% Report Generation Routes
    subgraph "Report API (/api/v1/reports)"
        GenerateReport[ğŸ“„ POST /generate<br/>Generate PDF Report<br/>ğŸ’¼ Professional+]
        PrintReport[ğŸ–¨ï¸ POST /print<br/>Print-Optimized Report<br/>ğŸ’¼ Professional+]
        CustomReport[ğŸ¨ POST /custom<br/>Custom Report<br/>ğŸ¢ Enterprise Only]
        ReportStatus[ğŸ“Š GET /status/:id<br/>Report Status<br/>ğŸ’¼ Professional+]
    end
    
    %% Integration Routes
    subgraph "Integration API (/api/v1/integrations)"
        WebhookEndpoint[ğŸ”— POST /webhook<br/>Webhook Endpoint<br/>ğŸ¢ Enterprise Only]
        APIStatus[ğŸ“Š GET /status<br/>API Status<br/>ğŸ” Auth Required]
        UsageStats[ğŸ“ˆ GET /usage<br/>Usage Statistics<br/>ğŸ” Auth Required]
    end
    
    %% Backend Services
    subgraph "Backend Services"
        SoilCalcService[ğŸ§® Soil Calculation Service<br/>24-Equation System]
        ReportService[ğŸ“„ Report Generation Service<br/>Puppeteer PDF]
        EmailService[ğŸ“§ Email Service<br/>SMTP Provider]
        AuthService[ğŸ” Authentication Service<br/>JWT Management]
    end
    
    %% Database
    subgraph "Database Layer"
        UserDB[(ğŸ‘¥ Users Table)]
        AnalysisDB[(ğŸŒ± Soil Analyses Table)]
        ReportDB[(ğŸ“„ Reports Table)]
        UsageDB[(ğŸ“Š Usage Records Table)]
        SubscriptionDB[(ğŸ’³ Subscriptions Table)]
    end
    
    %% Middleware Layer
    subgraph "Middleware"
        AuthMW[ğŸ” Authentication<br/>JWT Verification]
        TierMW[ğŸ¯ Tier Access Control<br/>Feature Gating]
        RateMW[â±ï¸ Rate Limiting<br/>Usage Throttling]
        ValidMW[âœ… Input Validation<br/>Data Sanitization]
    end
    
    %% Frontend to Gateway
    Landing --> Gateway
    MainApp --> Gateway
    Demo --> Gateway
    AdvDemo --> Gateway
    Profile --> Gateway
    
    %% Gateway to Auth Routes
    Gateway --> AuthRegister
    Gateway --> AuthLogin
    Gateway --> AuthVerify
    Gateway --> AuthReset
    Gateway --> AuthProfile
    
    %% Gateway to Soil Routes
    Gateway --> DemoAnalyze
    Gateway --> DemoEnhanced
    Gateway --> BasicAnalyze
    Gateway --> AdvAnalyze
    Gateway --> BatchAnalyze
    Gateway --> AnalysisHistory
    Gateway --> ExportData
    Gateway --> Recommendations
    Gateway --> MoistureCurve
    Gateway --> Profile3D
    Gateway --> CompareAnalyses
    Gateway --> RealtimeAdjust
    Gateway --> RegionalData
    Gateway --> AvailableRegions
    Gateway --> EnterpriseAPI
    
    %% Gateway to Report Routes
    Gateway --> GenerateReport
    Gateway --> PrintReport
    Gateway --> CustomReport
    Gateway --> ReportStatus
    
    %% Gateway to Integration Routes
    Gateway --> WebhookEndpoint
    Gateway --> APIStatus
    Gateway --> UsageStats
    
    %% Middleware Flow
    Gateway --> AuthMW
    Gateway --> TierMW
    Gateway --> RateMW
    Gateway --> ValidMW
    
    %% Services Integration
    AuthRegister --> AuthService
    AuthLogin --> AuthService
    BasicAnalyze --> SoilCalcService
    AdvAnalyze --> SoilCalcService
    GenerateReport --> ReportService
    AuthVerify --> EmailService
    
    %% Database Connections
    AuthService --> UserDB
    SoilCalcService --> AnalysisDB
    ReportService --> ReportDB
    AuthMW --> UsageDB
    TierMW --> SubscriptionDB
    
    %% Styling
    classDef frontend fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef gateway fill:#f3e5f5,stroke:#4a148c,stroke-width:3px
    classDef auth fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef soil fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef report fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef integration fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef service fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef database fill:#e8eaf6,stroke:#283593,stroke-width:2px
    classDef middleware fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef demo fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef professional fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef enterprise fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    
    class Landing,MainApp,Demo,AdvDemo,Profile frontend
    class Gateway gateway
    class AuthRegister,AuthLogin,AuthVerify,AuthReset,AuthProfile auth
    class BasicAnalyze,AdvAnalyze,BatchAnalyze,AnalysisHistory,ExportData,Recommendations,MoistureCurve,Profile3D,CompareAnalyses,RealtimeAdjust,RegionalData,AvailableRegions soil
    class GenerateReport,PrintReport,CustomReport,ReportStatus report
    class WebhookEndpoint,APIStatus,UsageStats integration
    class SoilCalcService,ReportService,EmailService,AuthService service
    class UserDB,AnalysisDB,ReportDB,UsageDB,SubscriptionDB database
    class AuthMW,TierMW,RateMW,ValidMW middleware
    class DemoAnalyze,DemoEnhanced,DemoMoisture,DemoProfile3D demo
    class EnterpriseAPI enterprise